description: TBD

docker:
  - image: circleci/node:12.18.4-browsers

parameters:
  node-env:
    type: env_var_name
    default: NODE_ENV
  aws-dist-id-env:
    type: env_var_name
    default: AWS_DIST_ID
  bucket-name:
    type: string
    default: ''

steps:
  - checkout
  - run:
      name: "Setup Environment"
      command: |
        mkdir -p ~/reports
        node --version
        npm --version
        env
  - node/install-packages
  - run:
    name: "Build Application"
    command: npm run build
  - aws-s3/sync:
      from: build
      to: "s3://$<< parameters.bucket-name >>"
      arguments: |
        --acl public-read \
        --cache-control "max-age=86400"
  - aws-cloudfront/invalidate:
        distribution_id: '$<<parameters.aws-dist-id-env >>'
        paths: "/index.html"
