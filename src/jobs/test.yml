description: >
  Tests Jest/Ava NodeJS test suites. using the command `npm test` (running the prerequesite command `npm pretest`)


parameters:
  test-suite:
    description: Enum whether to use Ava or Jest test suite.
    type: enum
    enum: [jest, ava]
    default: jest


steps:
  - checkout
  - attach_workspace:
      at: ~/project
  - run:
      name: "Setup Environment"
      command: |
        mkdir -p ~/reports
        node --version
        npm --version
        env
  - run:
      name: Install JUnit coverage reporter
      command: npm install --no-save --dev jest-junit
  - run: npm run pretest # not optimal
  - run:
      name: Run tests with JUnit as reporter
      command: npm test -- --ci --reporters=default --reporters=jest-junit
      environment:
        JEST_JUNIT_OUTPUT_DIR: ./reports/junit/
        NODE_ENV: test
  - store_test_results:
      path: ./reports/junit/
  - store_artifacts:
      path: ./reports/junit
