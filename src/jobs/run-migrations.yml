description: >
  Runs sequelize migration using the command: `npm run db:migrating` according to the .env secrets file (see the command collect-env-secrets)

executor:
  name: default

paramters:
  local-env-command:
    type: boolean
    default: false
steps:
  - checkout
  - aws-cli/install
  - aws-cli/setup
  - attach_workspace:
      at: ~/project
  - when:
      condition: << parameters.local-command >>
      steps:
        - run: node env.js
  - unless:
      condition: << parameters.local-env-command >>
      steps:
        - versatile/collect-env-secrets
  - run:
      name: 'Running DB Migrations'
      command: |
        env
        npm run db:prepare
